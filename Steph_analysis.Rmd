```{R} 
proj_dat = read.csv("C:/Users/JPRS1/Desktop/Datasets/proj_dat.csv")
dataSteph = proj_dat[which(proj_dat$AGEC >= 18), ]
```

```{r}
carb = cut(dataSteph$CHOPER1, breaks=c(-1, 45, 65, 100), labels=c("low", "med", "high"))
protein = cut(dataSteph$PROPER1, breaks=c(-1, 15, 25, 100), labels=c("low", "med", "high"))
fat = cut(dataSteph$FATPER1, breaks=c(-1, 20, 35, 100), labels=c("low", "med", "high"))
```


#can we predict who is obese according to BMI?
```{r}
library(MASS)
#bmi, age, exercise, 
dat1.var = dataSteph[,c(1,2,8, 11, 12, 14, 77, 86, 64, 65, 68)]
names(dat1.var) = c("bmi", "age", "mins.phys", "waist.cm", "bmr", "ses", "mins.sed", "sex", "protein", "fat", "carbs")

bmi.class = cut(dat1.var$bmi, breaks=c(18.5, 30, 65), labels=c("norm","obese")) #categorical
bmi.num = ifelse(bmi.class=="norm", 0,1) #binary
bmi1 = dat1.var$bmi #numeric
X = data.matrix(dat1.var[2:8])

#obese as binary for variables
mod = glm(bmi.num~X, family = binomial)
summary(mod)

#obese as continuous for variables
mod1 = glm(bmi1~X)
summary(mod1)

```
Have a smaller AIC when the data is run as continuous instead of binary. Using the binary variable model we have a log linear model of
$log(p/1-p) = -43.3 + 0.05*age + 0.18*waist.cm + 0.002*bmr - 0.00*mins.sed + 5.26*sex$
This tells us that the best model for describing BMI includes the following relationships:
- Higher age have a higher BMI
- Larger waist measurements have higher BMI
- Higher BMR have higher BMI
- More minutes per week sedentary is related to a higher BMI
- Females have a higher BMI than males

```{R}
#obese as binary for macronutrients
bmi.macro = glm(bmi.num~protein+carb+fat, family = binomial)
best.marco = stepAIC(bmi.macro, scope = list(upper = ~protein*carb*fat, lower = ~1))
summary(best.marco)

#do bmi as continuous predicted by macro-nutrients
diet.stat = glm(bmi1~protein+carb+fat)
best.diet = stepAIC(diet.stat, scope= list(upper = ~protein*carb*fat, lower = ~1))
best.diet
summary(best.diet)
```
Get similar results for predicting BMI when BMI is a continuous variable compared to a binary one. 
We are testing the null hypothesis that:
For BMI as a binary varible we have the model which an AIC of 9266:
$log(p/1-p) =  -1.12 + 0.18*MedProtein + 0.53*HighProtein$
The best predictor of BMI is protein. We have a log linear model for BMI as a continuous varaibles with an AIC of 49852 of 
$log(p/1-p) = 27.05 + 0.52*MedProtein + 1.58*HighProtein$. 
This indicates that higher BMI is related to higher levels of protein in a persons diet.  
Notice the intercepts and the AIC vary alot between the two models. 







Proportions across diets
- Do men have higher protein diets than women
- Do the proportions macro- nutrients in a persons diet differ across SES areas?
- Do macro- nutrient levels differ across gender?

$H_0: \mu_{protein female} = \mu_{protein male} = \mu_{carbs}$ versus $H_1: \mu_{protein female} != \mu_{protein male$
```{r}
#gender and diets
library(ggplot2)
ggplot(dat1.var, aes(x=sex, y=protein, group = sex)) + geom_boxplot() # 2 = female
lm.out = aov(protein~sex, data = dat1.var) #difference between groups
par(mfrow=c(2,2)) # assumptions not met
boxplot(lm.out$residuals) 
plot(lm.out, which=1:3) 
summary(lm.out)


ggplot(dat1.var, aes(x=sex, y=carbs, group = sex)) + geom_boxplot()
lm.2 = aov(carbs~sex, data = dat1.var)
par(mfrow=c(2,2)) # assumptions not met
boxplot(lm.2$residuals) 
plot(lm.2, which=1:3) 
summary(lm.2)

ggplot(dat1.var, aes(x=sex, y=fat, group = sex)) + geom_boxplot()
lm.3 = aov(fat~sex, data = dat1.var)
par(mfrow=c(2,2)) # assumptions not met
boxplot(lm.3$residuals) 
plot(lm.3, which=1:3) 
summary(lm.3)
```

#independence test for macronutrients levels and ses
```{r}
ses1 = cut(dat1.var$ses, breaks=c(0,4,5), labels=c("low", "med"))
dat1.var$ses.lvl = ses1
dat1.var$protein.lvl = protein
dat1.var$fat.lvl = fat
dat1.var$carbs.lvl = carb


ses.protein = table(dat1.var$protein.lvl,dat1.var$ses.lvl)
chisq.test(ses.protein) #p > 0.05 so maintain null hypothesis that protein level is independent of ses

ses.fat = table(dat1.var$fat.lvl,dat1.var$ses.lvl)
chisq.test(ses.fat) #p > 0.05 so maintain null hypothesis that fat level is independent of ses

ses.carbs = table(dat1.var$carbs.lvl,dat1.var$ses.lvl)
chisq.test(ses.carbs) # p < 0.05 so reject null hypothesis that carb level is independent of ses
```

#independence for macro and gender
```{r}
gen.protein = table(dat1.var$protein.lvl,dat1.var$sex)
chisq.test(gen.protein) # maintain null

gen.fat = table(dat1.var$fat.lvl,dat1.var$sex)
chisq.test(gen.fat) #reject null

gen.carbs = table(dat1.var$carbs.lvl,dat1.var$sex)
chisq.test(gen.carbs) #reject null
```

#indep for BMI class and macro
```{r}
dat1.var$bmi.lvl = bmi.class

bmi.protein = table(dat1.var$protein.lvl,dat1.var$bmi.lvl)
chisq.test(bmi.protein) #reject null

bmi.fat = table(dat1.var$fat.lvl,dat1.var$bmi.lvl)
chisq.test(bmi.fat) #maintain null

bmi.carbs = table(dat1.var$carbs.lvl,dat1.var$bmi.lvl)
chisq.test(bmi.carbs) #maintain null
```













