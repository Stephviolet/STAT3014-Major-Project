```{R, include = FALSE}
dat_orig = read.csv("C:/Users/JPRS1/Desktop/Datasets/nutmstatData2018.csv")
#dat_orig = read.csv("/users/ugrad/ssta9076/Desktop/nutmstatData2018.csv")
#install.packages("huxtable")
#install.packages("factoextra")
#library(factoextra)
#library(huxtable )
#library(ggplot2)
#install.packages("qwraps2")
library(qwraps2)
#dim(dat_orig)
library(dplyr)

dat <-  dat_orig

colNames <- colnames(dat_orig)

# for (i in 1:length(colNames)) { cat("categoricalList[",i,"] <- FALSE # ",colNames[i],"\n"); }
#categorical or numerical

categoricalList <- c()
categoricalList[ 1 ] <- FALSE #  BMISC 
categoricalList[ 2 ] <- FALSE #  AGEC 
categoricalList[ 3 ] <- TRUE #  SMSBC 
categoricalList[ 4 ] <- TRUE #  COBBC 
categoricalList[ 5 ] <- TRUE #  FEMLSBC 
categoricalList[ 6 ] <- FALSE #  PHDKGWBC 
categoricalList[ 7 ] <- FALSE #  PHDCMHBC 
categoricalList[ 8 ] <- FALSE #  EXLWTBC 
categoricalList[ 9 ] <- FALSE #  EXLWMBC 
categoricalList[ 10 ] <- FALSE #  EXLWVBC 
categoricalList[ 11 ] <- FALSE #  PHDCMWBC 
categoricalList[ 12 ] <- FALSE #  BMR 
categoricalList[ 13 ] <- FALSE #  EIBMR1 
categoricalList[ 14 ] <- TRUE #  SF2SA1QN 
categoricalList[ 15 ] <- TRUE #  INCDEC 
categoricalList[ 16 ] <- TRUE #  DIABBC 
categoricalList[ 17 ] <- TRUE #  HCHOLBC 
categoricalList[ 18 ] <- TRUE #  HSUGBC 
categoricalList[ 19 ] <- TRUE #  HYPBC 
categoricalList[ 20 ] <- FALSE #  ENERGYT1 
categoricalList[ 21 ] <- FALSE #  ENRGYT1 
categoricalList[ 22 ] <- FALSE #  MOISTT1 
categoricalList[ 23 ] <- FALSE #  PROTT1 
categoricalList[ 24 ] <- FALSE #  FATT1 
categoricalList[ 25 ] <- FALSE #  CHOWSAT1 
categoricalList[ 26 ] <- FALSE #  CHOWOAT1 
categoricalList[ 27 ] <- FALSE #  STARCHT1 
categoricalList[ 28 ] <- FALSE #  SUGART1 
categoricalList[ 29 ] <- FALSE #  FIBRET1 
categoricalList[ 30 ] <- FALSE #  ALCT1 
categoricalList[ 31 ] <- FALSE #  PREVAT1 
categoricalList[ 32 ] <- FALSE #  PROVAT1 
categoricalList[ 33 ] <- FALSE #  RETEQT1 
categoricalList[ 34 ] <- FALSE #  B1T1 
categoricalList[ 35 ] <- FALSE #  B2T1 
categoricalList[ 36 ] <- FALSE #  B3T1 
categoricalList[ 37 ] <- FALSE #  NIACINT1 
categoricalList[ 38 ] <- FALSE #  FOLATT1 
categoricalList[ 39 ] <- FALSE #  FOLICT1 
categoricalList[ 40 ] <- FALSE #  TOTFOLT1 
categoricalList[ 41 ] <- FALSE #  FOLEQT1 
categoricalList[ 42 ] <- FALSE #  B6T1 
categoricalList[ 43 ] <- FALSE #  B12T1 
categoricalList[ 44 ] <- FALSE #  VITCT1 
categoricalList[ 45 ] <- FALSE #  VITET1 
categoricalList[ 46 ] <- FALSE #  CALCT1 
categoricalList[ 47 ] <- FALSE #  IODINET1 
categoricalList[ 48 ] <- FALSE #  IRONT1 
categoricalList[ 49 ] <- FALSE #  MAGT1 
categoricalList[ 50 ] <- FALSE #  PHOST1 
categoricalList[ 51 ] <- FALSE #  POTAST1 
categoricalList[ 52 ] <- FALSE #  SELT1 
categoricalList[ 53 ] <- FALSE #  SODIUMT1 
categoricalList[ 54 ] <- FALSE #  ZINCT1 
categoricalList[ 55 ] <- FALSE #  CAFFT1 
categoricalList[ 56 ] <- FALSE #  CHOLT1 
categoricalList[ 57 ] <- FALSE #  SATFATT1 
categoricalList[ 58 ] <- FALSE #  MUFATT1 
categoricalList[ 59 ] <- FALSE #  PUFATT1 
categoricalList[ 60 ] <- FALSE #  LAT1 
categoricalList[ 61 ] <- FALSE #  ALAT1 
categoricalList[ 62 ] <- FALSE #  LCN3T1 
categoricalList[ 63 ] <- FALSE #  TRANST1 
categoricalList[ 64 ] <- FALSE #  PROPER1 
categoricalList[ 65 ] <- FALSE #  FATPER1 
categoricalList[ 66 ] <- FALSE #  LAPER1 
categoricalList[ 67 ] <- FALSE #  ALAPER1 
categoricalList[ 68 ] <- FALSE #  CHOPER1 
categoricalList[ 69 ] <- FALSE #  SUGPER1 
categoricalList[ 70 ] <- FALSE #  STARPER1 
categoricalList[ 71 ] <- FALSE #  ALCPER1 
categoricalList[ 72 ] <- FALSE #  SATPER1 
categoricalList[ 73 ] <- FALSE #  TRANPER1 
categoricalList[ 74 ] <- FALSE #  FIBRPER1 
categoricalList[ 75 ] <- FALSE #  MONOPER1 
categoricalList[ 76 ] <- FALSE #  POLYPER1 
categoricalList[ 77 ] <- FALSE #  ADTOTSE 
categoricalList[ 78 ] <- TRUE #  BDYMSQ04 given as NAs values by John 
categoricalList[ 79 ] <- FALSE #  DIASTOL 
categoricalList[ 80 ] <- TRUE #  DIETQ12 
categoricalList[ 81 ] <- TRUE #  DIETQ14 
categoricalList[ 82 ] <- TRUE #  DIETQ5 
categoricalList[ 83 ] <- TRUE #  DIETQ8 
categoricalList[ 84 ] <- TRUE #  DIETRDI 
categoricalList[ 85 ] <- TRUE #  SABDYMS 
categoricalList[ 86 ] <- TRUE #  SEX 
categoricalList[ 87 ] <- FALSE #  SLPTIME 
categoricalList[ 88 ] <- TRUE #  SMKDAILY 
categoricalList[ 89 ] <- TRUE #  SMKSTAT 
categoricalList[ 90 ] <- FALSE #  SYSTOL 
categoricalList[ 91 ] <- TRUE #  ABSPID 
categoricalList[ 92 ] <- FALSE #  GRAINS1N 
categoricalList[ 93 ] <- FALSE #  WHOLGR1N 
categoricalList[ 94 ] <- FALSE #  REFGRA1N 
categoricalList[ 95 ] <- FALSE #  VEGLEG1N 
categoricalList[ 96 ] <- FALSE #  GREENS1N 
categoricalList[ 97 ] <- FALSE #  VGORSV1N 
categoricalList[ 98 ] <- FALSE #  STARCH1N 
categoricalList[ 99 ] <- FALSE #  LEGVEG1N 
categoricalList[ 100 ] <- FALSE #  OTHVEG1N 
categoricalList[ 101 ] <- FALSE #  FRUIT1N 
categoricalList[ 102 ] <- FALSE #  FRJUIC1N 
categoricalList[ 103 ] <- FALSE #  DAIRY1N 
categoricalList[ 104 ] <- FALSE #  MEAT1N 
categoricalList[ 105 ] <- FALSE #  RDMTL1N 
categoricalList[ 106 ] <- FALSE #  RDMTLU1N 
categoricalList[ 107 ] <- FALSE #  RDMTN1N 
categoricalList[ 108 ] <- FALSE #  RDMTNU1N 
categoricalList[ 109 ] <- FALSE #  RDMTNP1N 
categoricalList[ 110 ] <- FALSE #  PLTYL1N 
categoricalList[ 111 ] <- FALSE #  PLTYLU1N 
categoricalList[ 112 ] <- FALSE #  FISH1N 
categoricalList[ 113 ] <- FALSE #  EGGS1N 
categoricalList[ 114 ] <- FALSE #  LEGMT1N 
categoricalList[ 115 ] <- FALSE #  NUTS1N 
categoricalList[ 116 ] <- FALSE #  WATER1N 
categoricalList[ 117 ] <- FALSE #  UNSAT1N 
categoricalList[ 118 ] <- FALSE #  FRESUG1N 
categoricalList[ 119 ] <- FALSE #  ADDSUG1N 
categoricalList[ 120 ] <- FALSE #  WATERG1N 
categoricalList[ 121 ] <- FALSE #  PEFRESD1 
categoricalList[ 122 ] <- FALSE #  PEADDSD1 
categoricalList[ 123 ] <- TRUE #  ALTNTR 
categoricalList[ 124 ] <- TRUE #  ALTRESB 
categoricalList[ 125 ] <- TRUE #  APOBNTR 
categoricalList[ 126 ] <- TRUE #  APOBRESB 
categoricalList[ 127 ] <- TRUE #  B12RESB 
categoricalList[ 128 ] <- TRUE #  BIORESPC 
categoricalList[ 129 ] <- TRUE #  CHOLNTR 
categoricalList[ 130 ] <- TRUE #  CHOLRESB 
categoricalList[ 131 ] <- TRUE #  CVDMEDST 
categoricalList[ 132 ] <- TRUE #  DIAHBRSK 
categoricalList[ 133 ] <- TRUE #  FASTSTAD 
categoricalList[ 134 ] <- TRUE #  FOLATREB 
categoricalList[ 135 ] <- TRUE #  GGTNTR 
categoricalList[ 136 ] <- TRUE #  GGTRESB 
categoricalList[ 137 ] <- TRUE #  GLUCFPD 
categoricalList[ 138 ] <- TRUE #  GLUCFREB 
categoricalList[ 139 ] <- TRUE #  HBA1PREB 
categoricalList[ 140 ] <- TRUE #  HDLCHREB 
categoricalList[ 141 ] <- TRUE #  LDLNTR 
categoricalList[ 142 ] <- TRUE #  LDLRESB 
categoricalList[ 143 ] <- TRUE #  TRIGNTR 
categoricalList[ 144 ] <- TRUE #  TRIGRESB 

for (i in 1:length(categoricalList)) {
  if (categoricalList[ i ]) {
      dat[,i] <- as.factor(dat[  ,i])
  }
}




# for (i in 1:length(colNames)) { cat("excludeList[[",i,"]] <- c() # ",colNames[i],"\n"); }
#removes certain observations

excludeList <- list()

excludeList[[ 1 ]] <- c(0,98,99) #  BMISC 
excludeList[[ 2 ]] <- c() #  AGEC 
excludeList[[ 3 ]] <- c(0) #  SMSBC 
excludeList[[ 4 ]] <- c() #  COBBC 
excludeList[[ 5 ]] <- c() #  FEMLSBC 
excludeList[[ 6 ]] <- c(0,997,998,999) #  PHDKGWBC 
excludeList[[ 7 ]] <- c(0,998,999) #  PHDCMHBC 
excludeList[[ 8 ]] <- c(9996, 9999) #  EXLWTBC 
excludeList[[ 9 ]] <- c() #  EXLWMBC 
excludeList[[ 10 ]] <- c() #  EXLWVBC 
excludeList[[ 11 ]] <- c(0,998,999) #  PHDCMWBC 
excludeList[[ 12 ]] <- c(99998) #  BMR 
excludeList[[ 13 ]] <- c(998) #  EIBMR1 
excludeList[[ 14 ]] <- c(0,99) #  SF2SA1QN 
excludeList[[ 15 ]] <- c(0,98,99) #  INCDEC 
excludeList[[ 16 ]] <- c() #  DIABBC 
excludeList[[ 17 ]] <- c() #  HCHOLBC 
excludeList[[ 18 ]] <- c() #  HSUGBC 
excludeList[[ 19 ]] <- c() #  HYPBC 
excludeList[[ 20 ]] <- c() #  ENERGYT1 
excludeList[[ 21 ]] <- c() #  ENRGYT1 
excludeList[[ 22 ]] <- c() #  MOISTT1 
excludeList[[ 23 ]] <- c() #  PROTT1 
excludeList[[ 24 ]] <- c() #  FATT1 
excludeList[[ 25 ]] <- c() #  CHOWSAT1 
excludeList[[ 26 ]] <- c() #  CHOWOAT1 
excludeList[[ 27 ]] <- c() #  STARCHT1 
excludeList[[ 28 ]] <- c() #  SUGART1 
excludeList[[ 29 ]] <- c() #  FIBRET1 
excludeList[[ 30 ]] <- c() #  ALCT1 
excludeList[[ 31 ]] <- c() #  PREVAT1 
excludeList[[ 32 ]] <- c() #  PROVAT1 
excludeList[[ 33 ]] <- c() #  RETEQT1 
excludeList[[ 34 ]] <- c() #  B1T1 
excludeList[[ 35 ]] <- c() #  B2T1 
excludeList[[ 36 ]] <- c() #  B3T1 
excludeList[[ 37 ]] <- c() #  NIACINT1 
excludeList[[ 38 ]] <- c() #  FOLATT1 
excludeList[[ 39 ]] <- c() #  FOLICT1 
excludeList[[ 40 ]] <- c() #  TOTFOLT1 
excludeList[[ 41 ]] <- c() #  FOLEQT1 
excludeList[[ 42 ]] <- c() #  B6T1 
excludeList[[ 43 ]] <- c() #  B12T1 
excludeList[[ 44 ]] <- c(10144.97) #  VITCT1 
excludeList[[ 45 ]] <- c() #  VITET1 
excludeList[[ 46 ]] <- c() #  CALCT1 
excludeList[[ 47 ]] <- c() #  IODINET1 
excludeList[[ 48 ]] <- c() #  IRONT1 
excludeList[[ 49 ]] <- c() #  MAGT1 
excludeList[[ 50 ]] <- c() #  PHOST1 
excludeList[[ 51 ]] <- c() #  POTAST1 
excludeList[[ 52 ]] <- c() #  SELT1 
excludeList[[ 53 ]] <- c() #  SODIUMT1 
excludeList[[ 54 ]] <- c() #  ZINCT1 
excludeList[[ 55 ]] <- c() #  CAFFT1 
excludeList[[ 56 ]] <- c() #  CHOLT1 
excludeList[[ 57 ]] <- c() #  SATFATT1 
excludeList[[ 58 ]] <- c() #  MUFATT1 
excludeList[[ 59 ]] <- c() #  PUFATT1 
excludeList[[ 60 ]] <- c() #  LAT1 
excludeList[[ 61 ]] <- c() #  ALAT1 
excludeList[[ 62 ]] <- c() #  LCN3T1 
excludeList[[ 63 ]] <- c() #  TRANST1 
excludeList[[ 64 ]] <- c() #  PROPER1 
excludeList[[ 65 ]] <- c() #  FATPER1 
excludeList[[ 66 ]] <- c() #  LAPER1 
excludeList[[ 67 ]] <- c() #  ALAPER1 
excludeList[[ 68 ]] <- c() #  CHOPER1 
excludeList[[ 69 ]] <- c() #  SUGPER1 
excludeList[[ 70 ]] <- c() #  STARPER1 
excludeList[[ 71 ]] <- c() #  ALCPER1 
excludeList[[ 72 ]] <- c() #  SATPER1 
excludeList[[ 73 ]] <- c() #  TRANPER1 
excludeList[[ 74 ]] <- c() #  FIBRPER1 
excludeList[[ 75 ]] <- c() #  MONOPER1 
excludeList[[ 76 ]] <- c() #  POLYPER1 
excludeList[[ 77 ]] <- c(0, 9999, 9996) #  ADTOTSE 
excludeList[[ 78 ]] <- c(0,6) #  BDYMSQ04 
excludeList[[ 79 ]] <- c(0,998,999) #  DIASTOL 
excludeList[[ 80 ]] <- c(0,6) #  DIETQ12 
excludeList[[ 81 ]] <- c(0,6) #  DIETQ14 
excludeList[[ 82 ]] <- c(0) #  DIETQ5 
excludeList[[ 83 ]] <- c(0) #  DIETQ8 
excludeList[[ 84 ]] <- c(0,3) #  DIETRDI 
excludeList[[ 85 ]] <- c(0,8,9) #  SABDYMS 
excludeList[[ 86 ]] <- c() #  SEX 
excludeList[[ 87 ]] <- c(0,9998,9999) #  SLPTIME 
excludeList[[ 88 ]] <- c() #  SMKDAILY 
excludeList[[ 89 ]] <- c(0) #  SMKSTAT 
excludeList[[ 90 ]] <- c(0,998,999) #  SYSTOL 
excludeList[[ 91 ]] <- c() #  ABSPID 
excludeList[[ 92 ]] <- c() #  GRAINS1N 
excludeList[[ 93 ]] <- c() #  WHOLGR1N 
excludeList[[ 94 ]] <- c() #  REFGRA1N 
excludeList[[ 95 ]] <- c() #  VEGLEG1N 
excludeList[[ 96 ]] <- c() #  GREENS1N 
excludeList[[ 97 ]] <- c() #  VGORSV1N 
excludeList[[ 98 ]] <- c() #  STARCH1N 
excludeList[[ 99 ]] <- c() #  LEGVEG1N 
excludeList[[ 100 ]] <- c() #  OTHVEG1N 
excludeList[[ 101 ]] <- c() #  FRUIT1N 
excludeList[[ 102 ]] <- c() #  FRJUIC1N 
excludeList[[ 103 ]] <- c() #  DAIRY1N 
excludeList[[ 104 ]] <- c() #  MEAT1N 
excludeList[[ 105 ]] <- c() #  RDMTL1N 
excludeList[[ 106 ]] <- c() #  RDMTLU1N 
excludeList[[ 107 ]] <- c() #  RDMTN1N 
excludeList[[ 108 ]] <- c() #  RDMTNU1N 
excludeList[[ 109 ]] <- c() #  RDMTNP1N 
excludeList[[ 110 ]] <- c() #  PLTYL1N 
excludeList[[ 111 ]] <- c() #  PLTYLU1N 
excludeList[[ 112 ]] <- c() #  FISH1N 
excludeList[[ 113 ]] <- c() #  EGGS1N 
excludeList[[ 114 ]] <- c() #  LEGMT1N 
excludeList[[ 115 ]] <- c() #  NUTS1N 
excludeList[[ 116 ]] <- c() #  WATER1N 
excludeList[[ 117 ]] <- c() #  UNSAT1N 
excludeList[[ 118 ]] <- c() #  FRESUG1N 
excludeList[[ 119 ]] <- c() #  ADDSUG1N 
excludeList[[ 120 ]] <- c() #  WATERG1N 
excludeList[[ 121 ]] <- c() #  PEFRESD1 
excludeList[[ 122 ]] <- c() #  PEADDSD1 
excludeList[[ 123 ]] <- c(0,8) #  ALTNTR 
excludeList[[ 124 ]] <- c(97,98) #  ALTRESB 
excludeList[[ 125 ]] <- c(0,8) #  APOBNTR 
excludeList[[ 126 ]] <- c(97,98) #  APOBRESB 
excludeList[[ 127 ]] <- c(97,98) #  B12RESB 
excludeList[[ 128 ]] <- c(0) #  BIORESPC 
excludeList[[ 129 ]] <- c(0,8) #  CHOLNTR 
excludeList[[ 130 ]] <- c(97,98) #  CHOLRESB 
excludeList[[ 131 ]] <- c(0,8) #  CVDMEDST 
excludeList[[ 132 ]] <- c(0,8) #  DIAHBRSK 
excludeList[[ 133 ]] <- c(0) #  FASTSTAD 
excludeList[[ 134 ]] <- c(97,98) #  FOLATREB 
excludeList[[ 135 ]] <- c(8) #  GGTNTR 
excludeList[[ 136 ]] <- c(97,98) #  GGTRESB 
excludeList[[ 137 ]] <- c(0,8) #  GLUCFPD 
excludeList[[ 138 ]] <- c(97,98) #  GLUCFREB 
excludeList[[ 139 ]] <- c(7,8) #  HBA1PREB 
excludeList[[ 140 ]] <- c(7,8) #  HDLCHREB 
excludeList[[ 141 ]] <- c(0,8) #  LDLNTR 
excludeList[[ 142 ]] <- c(97,98) #  LDLRESB 
excludeList[[ 143 ]] <- c(0,8) #  TRIGNTR 
excludeList[[ 144 ]] <- c(97,98) #  TRIGRESB 

for (i in 1:length(excludeList)) {
  dat[ dat[,i]%in%excludeList[[ i ]],i] <- NA
}

```

```{R, include = F}
#keep variables with less than 50% missing values
keepR = which(apply(is.na(dat), 1, mean)<= 1) #keep rows where there are less than 100% NAs
keepC = which(apply(is.na(dat), 2, mean) <= 0.5) #keep columns where there are less than 50% NAs
proj_dat = dat[keepR, keepC]
sum(is.na(dat$GLUCFPD))
```


##High protein, low carb diet, no children, split into diet and no diet
```{r}
dataSteph = proj_dat[which(proj_dat$PROPER1 > 20 & proj_dat$CHOPER1 < 45 & proj_dat$AGEC >= 18), ]
```

```{R}
library(ggplot2)
# Scatterplot BMI v BMR
sex<-factor(ifelse(dataSteph$SEX==1,'male','female'))
diet = factor(ifelse(dataSteph$BDYMSQ04 == 5, 'no diet', 'diet')) #changed Ton's if diet code - was only giving not on diet
BMIvBMR<-na.omit(data.frame(BMI=dataSteph$BMISC,BMR=dataSteph$BMR,Sex=sex,Diet=diet))
ggplot(BMIvBMR,aes(x=BMI,y=BMR))+geom_point(aes(colour=Sex))+geom_smooth(aes(group=Sex),method = "lm") #group by gender
```
Comment: Higher BMI is positively correlated with high BMR. Females show a lower BMR to males but BMIs across both genders are in roughly the same range. 

```{R}
# BMI v Diet
BMIvDiet<-na.omit(data.frame(BMI=dataSteph$BMISC,Sex=sex,Diet=diet)) 

ggplot(BMIvDiet,aes(x=BMI,group=factor(Diet),fill=factor(Diet)))+geom_histogram(aes(y=..density..),position='dodge',bins=10)+labs(title = "BMI density across diet status")
ggplot(BMIvBMR,aes(x=BMR,group=factor(Diet),fill=factor(Diet)))+geom_histogram(aes(y=..density..),position='dodge',bins=10)+labs(title = "BMR density across diet status")
```
Comment BMI density across diet status: there are more people not on diets with BMIs under 30 and slightly more people who are on diets with BMIs greater than 30 (may not be unexpected: people who are on diets may be trying to lose weight hence the higher BMI). 
Comment BMR density across diet status: there are more people who are on diets with BMR under 6000 and more peolpe who are not on diets with BMR above 6000 (not too sure why this could be). 

```{R}
t.test(BMI~Diet,data=BMIvBMR)
t.test(BMR~Diet,data=BMIvBMR)
av1 = anova(lm(BMR~BMI+Diet,data=BMIvBMR))
av2 = anova(lm(BMR~Diet+BMI,data=BMIvBMR))
var.test(BMI~Diet,data=BMIvBMR)
var(BMIvBMR$BMI[BMIvBMR$Diet=='diet'])
var(BMIvBMR$BMI[BMIvBMR$Diet=='no diet'])
var.test(BMR~Diet,data=BMIvBMR)


no_av1 = lm(BMR~BMI+Diet,data=BMIvBMR)
par(mfrow=c(2,2)) 
boxplot(no_av1$residuals) 
plot(no_av1, which=1:3, add.smooth=FALSE) 

no_av2 = lm(BMR~Diet+BMI,data=BMIvBMR)
par(mfrow=c(2,2)) 
boxplot(no_av2$residuals) 
plot(no_av2, which=1:3, add.smooth=FALSE)
```
Comment t test BMI~diet : null hypothesis is that there is no difference in mean BMI of people dieting and not dieting. p < 0.05 so we reject the null hypithesis and say that there is evidence of a significant difference between the mean BMIs of the two groups. 

Comment t test BMR~diet : p > 0.05. accept H0 that there is no differnce in BMR of the two diet groups. 

Comment ANOVA1: have the model $Y_{ij} = mu + \alpha_i + \beta_j + \epsilon_{ij}$ and testing the hypothesis that $H_0: BMI Effect = 0$. Since  both diet and BMI are significant when accounting for BMI across diet we cant drop diet.
Comment ANOVA2: have the model $Y_{ij} = mu + \alpha_i + \beta_j + \epsilon_{ij}$ and testing the hypothesis that $H_0: Diet Effect = 0$. Since both diet is not significant when accounting for diet and then BMI but BMI is significant, we cant drop diet. Note that these designs are not orthognoal. 

Assumptions: 
- Common variance for BMI~Diet: met
- Common var for BMR~Diet: not met

```{r}
anova(lm(BMR~BMI*Diet,data=BMIvBMR)) #2 factor ANOVA -BMI IS NOT A FACTOR
anova(lm(BMR~Diet*BMI,data=BMIvBMR))
```
ANOVA explained: A*B produces the B main e???ect SS adjusted for A, i.e. SSB|A and the A main e???ects SS ignoring B, i.e. SSA as in a 1-way ANOVA on A treatments alone. The sum of squares due to A but ignoring B, SSA, should not be used to test if the A main e???ects can be dropped from the model. 

Comment on ANOVA1: have tested SSBMI|diet. SSBMI in 2 factor = SSBMI in 1 way ANOVA and then has produced SSB|A. Thus, since p = 0.01415 < 0.05 we cant drop any variables from this model since the interaction term (ab)_ij != 0. 

Comment on ANOVA2:cant drop any vairables from this model either. 

```{R}
# Energy Intake
EIBMR.Data<-na.omit(data.frame(EIBMR=dataSteph$EIBMR1,BMI=dataSteph$BMISC,BMR=dataSteph$BMR,Sex=sex, Diet=diet))
                         
ggplot(EIBMR.Data,aes(x=EIBMR,y=BMR))+geom_point(aes(colour=Sex))+geom_smooth(aes(group=Sex),method = "lm")
ggplot(EIBMR.Data,aes(x=EIBMR,group=factor(Diet),fill=factor(Diet)))+geom_histogram(aes(y=..density..),position='dodge',bins=10)

summary(lm(EIBMR~BMR,data=EIBMR.Data))
summary(lm(EIBMR~Diet,data=EIBMR.Data))
t.test(EIBMR~Diet,data=EIBMR.Data)
var.test(EIBMR~Diet,data=EIBMR.Data)
bartlett.test(EIBMR~Diet,data=EIBMR.Data) 
var(EIBMR.Data$EIBMR[EIBMR.Data$Diet=='diet'])
var(EIBMR.Data$EIBMR[EIBMR.Data$Diet=='no diet'])

t.test(EIBMR~Sex,data=EIBMR.Data)
var.test(EIBMR~Sex,data=EIBMR.Data)
bartlett.test(EIBMR~Sex,data=EIBMR.Data) 
```
Comment energy by BMR : negative relationship between BMR and BMR energy. Lower BMR energy has higher BMR. Females appears to have a lower BMR than males (consistent with prvious graphs) and have a smaller BMR energy range than males. 
Comment BMR energy density : more people who are on diets have EIBMR less than 1 compared to people not on diets. There are more people who are not on diets with EIBMR higher than 1 compared to people who are on diets (not sure what this means). 

Comment ANOVA1:
Comment ANOVA2:

Comment t test : $H_0: \mu_{diet} = \mu_{no diet}$. Since p < 0.05, reject null hyothesis and say that there is a difference across diet and no diet EIBMR means. 
Variance test: p<0.05, reject then null hypothesis that variances are the same across two groups - assumption of common variance not met here. 
Bartletts test: same finding. 

Comment t test: $H_0: \mu_{males} = \mu_{females}$. Since p > 0.05, accept null hyothesis and say that there is no difference across male and female EIBMR means. 
Variance test: variances are different. 
Bartletts test: same finding. 

```{R}
# Stepwise Seleciton
library(leaps)
library(bestglm)
Data.candidate<-na.omit(data.frame(BMR=dataSteph$BMR,EIBMR=dataSteph$EIBMR1,BMI=dataSteph$BMISC,Sex=sex,Diet=diet, Hypterintensive = dataSteph$HYPBC,ADTOTSE=dataSteph$ADTOTSE,Age=dataSteph$AGEC))
                           
model.full<-regsubsets(BMI ~ . , data=Data.candidate, method="exhaustive")
        
X<-Data.candidate[,names(Data.candidate)!='BMI']
y<-Data.candidate$BMI
Xy<-cbind(X,y)
model.bestglm<-bestglm(Xy,IC='BIC')#exhaustive search, use method=forward for forward selection
models.table<-model.bestglm$Subsets
summary(lm(y~.,data=X[as.logical(models.table[2,2:(ncol(models.table)-2)])]))
```
Finding the best model using forward selection. Best model with lowest BMI includes all variables except for ADTOTSE. 

```{R}
# k-fold cross-validation
K<-10
n<-nrow(Xy)
m<-nrow(models.table)-1 #number of models comparing
g<-20 #run CV multiple times and average the result since the CV error depend on the split of dataset
err.out<-matrix(0,K*g,m) #miss-classification rate

##
set.seed(0)
fold<-sample(rep(1:K, each=n/K))

##
for(ginger in 1:g){fold<-sample(rep(1:K, each=n/K))
for(i in 1:m){
  for(k in 1:K){
    data.train<-Xy[fold!=k,]
    data.test<-Xy[fold==k,]
    mod.train<-lm(y~.,data=X[as.logical(models.table[i+1,2:(ncol(models.table)-2)])])
    pred.test<-predict(mod.train, newdata=data.test)
    # err.out[k,i]<-sum(abs(data.test$Survived-pred.test))/length(pred.test)
    err.out[(ginger-1)*K+k,i]<-mean((data.test$y-pred.test)^2)
  }
}
}
cv<-apply(err.out,2,mean)
cv.sd<-apply(err.out,2,sd)
cv.estimation<-cbind(cv,cv-cv.sd,cv+cv.sd)
colnames(cv.estimation)<-c('CV','cv-SE(CV)','CV+SE(CV)')
cv.estimation
plot(cv.estimation[,1],type='b',ylim=c(8,28))
lines(cv.estimation[,2],lty=2,col='blue')
lines(cv.estimation[,3],lty=2,col='blue')

```